<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forex Trading Goal Tracker - ¬£50,000 Journey</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Midnight Timer -->
        <div class="midnight-timer">
            <div class="timer-controls">
                <span class="timer-label">Time Since:</span>
                <input type="datetime-local" id="timerStartDate" class="timer-date-input" oninput="updateTimerStartDate()" onchange="updateTimerStartDate()">
            </div>
            <span class="timer-display" id="midnightTimer">00:00:00</span>
        </div>

        <!-- Header Section -->
        <header class="header">
            <div class="header-content">
                <div>
                    <h1>üéØ Forex Trading Goal Tracker</h1>
                    <p class="tagline">Your Journey to ¬£50,000 in Payouts</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary btn-small" id="syncButton" onclick="toggleSyncMenu()">‚òÅÔ∏è Sync</button>
                    <button class="btn btn-secondary btn-small" onclick="exportData()">üì• Export</button>
                    <button class="btn btn-secondary btn-small" onclick="document.getElementById('importFile').click()">üì§ Import</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                    <div class="sync-menu" id="syncMenu" style="display: none;">
                        <button class="sync-menu-item" onclick="showGitHubSetup()">‚öôÔ∏è Setup GitHub Sync</button>
                        <button class="sync-menu-item" onclick="syncToCloud()" id="syncToCloudBtn" disabled>‚Üë Push to Cloud</button>
                        <button class="sync-menu-item" onclick="syncFromCloud()" id="syncFromCloudBtn" disabled>‚Üì Pull from Cloud</button>
                        <button class="sync-menu-item" onclick="disconnectGitHub()" id="disconnectBtn" disabled>üîå Disconnect</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- R-Multiple Tracker Section -->
        <section class="r-tracker-section">
            <div class="r-tracker-card">
                <div class="r-tracker-header">
                    <h2>R-Multiple Goal Tracker</h2>
                    <div class="r-goal-display">
                        <span class="r-goal">20R</span>
                        <span class="r-separator">|</span>
                        <span class="r-current" id="rCurrent">0R</span>
                    </div>
                </div>

                <div class="r-progress-container">
                    <div class="r-progress-bar" id="rProgressBar"></div>
                    <span class="r-progress-text" id="rProgressText">0%</span>
                </div>

                <div class="r-actions">
                    <button class="btn btn-primary" onclick="showAddRModal()">+ Add R</button>
                    <button class="btn btn-secondary" onclick="showRHistoryModal()">View History</button>
                </div>

                <div class="r-mini-chart">
                    <canvas id="rMiniChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Main Goal Progress Section -->
        <section class="goal-section">
            <div class="goal-card">
                <h2>Overall Goal Progress</h2>
                <div class="goal-amount">
                    <span class="current-amount" id="totalPayouts">¬£0</span>
                    <span class="goal-amount-text">/ ¬£50,000</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="progress-stats">
                    <div class="stat">
                        <span class="stat-label">Progress</span>
                        <span class="stat-value" id="progressPercent">0%</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Remaining</span>
                        <span class="stat-value" id="remaining">¬£50,000</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Unrealized Profit</span>
                        <span class="stat-value positive" id="unrealizedProfit">¬£0</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quick Stats Dashboard -->
        <section class="stats-dashboard">
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-content">
                    <h3 id="activeChallenges">0</h3>
                    <p>Active Challenges</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-content">
                    <h3 id="completedChallenges">0</h3>
                    <p>Completed Challenges</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-content">
                    <h3 id="avgPayout">¬£0</h3>
                    <p>Avg Payout</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìà</div>
                <div class="stat-content">
                    <h3 id="successRate">0%</h3>
                    <p>Success Rate</p>
                </div>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="charts-section">
            <div class="chart-card">
                <h3>Payout History</h3>
                <canvas id="payoutChart"></canvas>
            </div>
            <div class="chart-card">
                <h3>Challenge Balance Trends</h3>
                <canvas id="balanceChart"></canvas>
            </div>
        </section>

        <!-- Challenge Accounts Section -->
        <section class="challenges-section">
            <div class="section-header">
                <h2>Challenge Accounts</h2>
                <button class="btn btn-primary" onclick="showAddChallengeModal()">+ Add Challenge</button>
            </div>
            <div class="challenges-grid" id="challengesGrid">
                <div class="empty-state">
                    <p>No challenges yet. Add your first challenge to start tracking!</p>
                </div>
            </div>
        </section>

        <!-- Payout History Section -->
        <section class="payouts-section">
            <div class="section-header">
                <h2>Payout History</h2>
                <button class="btn btn-primary" onclick="showAddPayoutModal()">+ Record Payout</button>
            </div>
            <div class="payouts-list" id="payoutsList">
                <div class="empty-state">
                    <p>No payouts recorded yet. Record your first payout to track your progress!</p>
                </div>
            </div>
        </section>
    </div>

    <!-- Add Challenge Modal -->
    <div class="modal" id="addChallengeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="challengeModalTitle">Add Challenge Account</h3>
                <button class="close-btn" onclick="closeModal('addChallengeModal')">&times;</button>
            </div>
            <form id="challengeForm" onsubmit="saveChallengeAccount(event)">
                <input type="hidden" id="challengeId">
                <div class="form-group">
                    <label for="challengeName">Challenge Name *</label>
                    <input type="text" id="challengeName" required placeholder="e.g., FTMO 100K Phase 1">
                </div>
                <div class="form-group">
                    <label for="challengeProvider">Provider</label>
                    <input type="text" id="challengeProvider" placeholder="e.g., FTMO, MyForexFunds">
                </div>
                <div class="form-group">
                    <label for="initialBalance">Initial Balance (¬£) *</label>
                    <input type="number" id="initialBalance" required min="0" step="0.01" placeholder="10000">
                </div>
                <div class="form-group">
                    <label for="currentBalance">Current Balance (¬£) *</label>
                    <input type="number" id="currentBalance" required min="0" step="0.01" placeholder="10000">
                </div>
                <div class="form-group">
                    <label for="challengeStatus">Status *</label>
                    <select id="challengeStatus" required>
                        <option value="active">Active</option>
                        <option value="passed">Passed</option>
                        <option value="failed">Failed</option>
                        <option value="funded">Funded</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="startDate">Start Date</label>
                    <input type="date" id="startDate">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addChallengeModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Challenge</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Balance Entry Modal -->
    <div class="modal" id="addBalanceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Record Balance</h3>
                <button class="close-btn" onclick="closeModal('addBalanceModal')">&times;</button>
            </div>
            <form id="balanceForm" onsubmit="saveBalanceEntry(event)">
                <input type="hidden" id="balanceChallengeId">
                <div class="form-group">
                    <label for="balanceDate">Date *</label>
                    <input type="date" id="balanceDate" required>
                </div>
                <div class="form-group">
                    <label for="balanceAmount">Balance (¬£) *</label>
                    <input type="number" id="balanceAmount" required min="0" step="0.01" placeholder="10500">
                </div>
                <div class="form-group">
                    <label for="balanceNotes">Notes</label>
                    <textarea id="balanceNotes" rows="3" placeholder="Optional notes about this entry..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addBalanceModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Balance</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Payout Modal -->
    <div class="modal" id="addPayoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Record Payout</h3>
                <button class="close-btn" onclick="closeModal('addPayoutModal')">&times;</button>
            </div>
            <form id="payoutForm" onsubmit="savePayout(event)">
                <div class="form-group">
                    <label for="payoutAmount">Payout Amount (¬£) *</label>
                    <input type="number" id="payoutAmount" required min="0" step="0.01" placeholder="2500">
                </div>
                <div class="form-group">
                    <label for="payoutDate">Date *</label>
                    <input type="date" id="payoutDate" required>
                </div>
                <div class="form-group">
                    <label for="payoutSource">Source</label>
                    <input type="text" id="payoutSource" placeholder="e.g., FTMO Account">
                </div>
                <div class="form-group">
                    <label for="payoutNotes">Notes</label>
                    <textarea id="payoutNotes" rows="3" placeholder="Optional notes..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addPayoutModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Payout</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Challenge Detail Modal -->
    <div class="modal" id="challengeDetailModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="challengeDetailTitle">Challenge Details</h3>
                <button class="close-btn" onclick="closeModal('challengeDetailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="challenge-detail-stats">
                    <div class="detail-stat-card">
                        <div class="detail-stat-label">Current Balance</div>
                        <div class="detail-stat-value" id="detailCurrentBalance">¬£0</div>
                    </div>
                    <div class="detail-stat-card">
                        <div class="detail-stat-label">Initial Balance</div>
                        <div class="detail-stat-value" id="detailInitialBalance">¬£0</div>
                    </div>
                    <div class="detail-stat-card">
                        <div class="detail-stat-label">Profit/Loss</div>
                        <div class="detail-stat-value" id="detailProfitLoss">¬£0</div>
                    </div>
                    <div class="detail-stat-card">
                        <div class="detail-stat-label">Return</div>
                        <div class="detail-stat-value" id="detailReturn">0%</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h4>Balance History</h4>
                    <canvas id="challengeDetailChart"></canvas>
                </div>

                <div class="balance-history-section">
                    <div class="section-header">
                        <h4>Balance Entries</h4>
                        <button class="btn btn-primary btn-small" onclick="showBalanceModalFromDetail()">+ Add Entry</button>
                    </div>
                    <div class="balance-history-list" id="balanceHistoryList">
                        <div class="empty-state">No balance entries yet.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add R-Multiple Modal -->
    <div class="modal" id="addRModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add R-Multiple Entry</h3>
                <button class="close-btn" onclick="closeModal('addRModal')">&times;</button>
            </div>
            <form id="rForm" onsubmit="saveREntry(event)">
                <div class="form-group">
                    <label for="rValue">R Value *</label>
                    <input type="number" id="rValue" required step="0.1" placeholder="e.g., 2.5 or -1" autofocus>
                    <small style="color: var(--text-secondary); display: block; margin-top: 5px;">
                        Enter positive for wins (e.g., 2.5R) or negative for losses (e.g., -1R)
                    </small>
                </div>
                <div class="form-group">
                    <label for="rDate">Date *</label>
                    <input type="date" id="rDate" required>
                </div>
                <div class="form-group">
                    <label for="rNotes">Notes</label>
                    <textarea id="rNotes" rows="3" placeholder="Optional notes about this trade..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addRModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Entry</button>
                </div>
            </form>
        </div>
    </div>

    <!-- R-Multiple History Modal -->
    <div class="modal" id="rHistoryModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>R-Multiple History</h3>
                <button class="close-btn" onclick="closeModal('rHistoryModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="r-history-stats">
                    <div class="detail-stat-card">
                        <div class="detail-stat-label">Current Total</div>
                        <div class="detail-stat-value" id="historyCurrentR">0R</div>
                    </div>
                    <div class="detail-stat-card">
                        <div class="detail-stat-label">Goal</div>
                        <div class="detail-stat-value">20R</div>
                    </div>
                    <div class="detail-stat-card">
                        <div class="detail-stat-label">Total Entries</div>
                        <div class="detail-stat-value" id="historyTotalEntries">0</div>
                    </div>
                    <div class="detail-stat-card">
                        <div class="detail-stat-label">Win Rate</div>
                        <div class="detail-stat-value" id="historyWinRate">0%</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h4>R-Multiple Progress Over Time</h4>
                    <canvas id="rHistoryChart"></canvas>
                </div>

                <div class="balance-history-section">
                    <div class="section-header">
                        <h4>All Entries</h4>
                    </div>
                    <div class="balance-history-list" id="rEntriesList">
                        <div class="empty-state">No R entries yet.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- GitHub Sync Setup Modal -->
    <div class="modal" id="githubSetupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Setup GitHub Cloud Sync</h3>
                <button class="close-btn" onclick="closeModal('githubSetupModal')">&times;</button>
            </div>
            <div style="padding: 25px;">
                <div class="info-box">
                    <h4>How to get your GitHub Token:</h4>
                    <ol>
                        <li>Go to <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Tokens (classic)</a></li>
                        <li>Click <strong>"Generate new token (classic)"</strong> (NOT fine-grained)</li>
                        <li>Give it a name (e.g., "Trading Goals Sync")</li>
                        <li>Select expiration: Choose "No expiration" or custom date</li>
                        <li>‚úÖ Check ONLY the <strong>"gist"</strong> scope (Create gists)</li>
                        <li>Scroll down and click "Generate token"</li>
                        <li>Copy the token immediately (you won't see it again!)</li>
                    </ol>
                    <p style="margin-top: 15px; color: #fbbf24; font-size: 0.9rem;">
                        ‚ö†Ô∏è Important: The token starts with "ghp_" and is about 40 characters long.
                    </p>
                </div>
                <form id="githubSetupForm" onsubmit="saveGitHubToken(event)">
                    <div class="form-group">
                        <label for="githubToken">GitHub Personal Access Token *</label>
                        <input type="password" id="githubToken" required placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                        <small style="color: var(--text-secondary); display: block; margin-top: 5px;">
                            Your token is stored locally and never shared
                        </small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('githubSetupModal')">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save & Connect</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
